<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de Pel√≠culas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/cssp/estilos.css}">
</head>
<body>

 <header th:insert="~{fragments/header :: menu-principal}"></header>

  <div class="container mt-5">
    <h1 class="text-center mb-4">Gesti√≥n de Pel√≠culas</h1>

    <!-- Selecci√≥n de g√©nero -->
    <div class="row row-cols-2 row-cols-md-5 g-3 mb-4">
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/1}">
        <img th:src="@{/imgp/accion/rapidos.jpg}" class="img-thumb rounded shadow" alt="Acci√≥n">
        <p class="mt-2">Acci√≥n</p>
      </a>
	  <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/2}">
	     <img th:src="@{/imgp/terror/nosferatu.jpg}" class="img-thumb rounded shadow" alt="Terror">
	     <p class="mt-2">Terror</p>
	   </a>
	   <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/3}">
	      <img th:src="@{/imgp/ciencia_ficcion/avengers.jpg}" class="img-thumb rounded shadow" alt="Ciencia Ficci√≥n">
	      <p class="mt-2">Ciencia Ficci√≥n</p>
	   </a>
	  <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/4}">
        <img th:src="@{/imgp/comedia/ayer.jpg}" class="img-thumb rounded shadow" alt="Comedia">
        <p class="mt-2">Comedia</p>
      </a>
	  <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/5}">
        <img th:src="@{/imgp/musicales/acomplete.jpg}" class="img-thumb rounded shadow" alt="Musicales">
        <p class="mt-2">Musicales</p>
      </a>
	  <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/6}">
        <img th:src="@{/imgp/romance/efimera.jpg}" class="img-thumb rounded shadow" alt="Romance">
        <p class="mt-2">Romance</p>
      </a>
	  <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/7}">
        <img th:src="@{/imgp/suspenso/losojos.jpg}" class="img-thumb rounded shadow" alt="Suspenso">
        <p class="mt-2">Suspenso</p>
      </a>
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/8}">
        <img th:src="@{/imgp/animes/onepiece.jpg}" class="img-thumb rounded shadow" alt="Anime">
        <p class="mt-2">Anime</p>
      </a>
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/9}">
        <img th:src="@{/imgp/aventura/willow.jpg}" class="img-thumb rounded shadow" alt="Aventura">
        <p class="mt-2">Aventura</p>
      </a>
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/10}">
        <img th:src="@{/imgp/catastrofe/sanandres.jpg}" class="img-thumb rounded shadow" alt="Cat√°strofe">
        <p class="mt-2">Cat√°strofe</p>
      </a>
     
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/11}">
        <img th:src="@{/imgp/documental/almudena.jpg}" class="img-thumb rounded shadow" alt="Documental">
        <p class="mt-2">Documental</p>
      </a>
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/12}">
        <img th:src="@{/imgp/drama/ni√±o.jpg}" class="img-thumb rounded shadow" alt="Drama">
        <p class="mt-2">Drama</p>
      </a>
      <a class="col text-center text-decoration-none text-white" th:href="@{/peliculas/genero/13}">
        <img th:src="@{/imgp/fantasia/anillos.jpg}" class="img-thumb rounded shadow" alt="Fantas√≠a">
        <p class="mt-2">Fantas√≠a</p>
      </a>
    </div>

    <!-- Formulario de b√∫squeda -->
    <form class="row g-3 justify-content-center mb-4" th:action="@{/peliculas/buscar}" method="get">
      <div class="col-auto">
        <input type="number" class="form-control" name="id" placeholder="Ingrese ID de Usuario">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-success">
          <i class="bi bi-search"></i> Buscar por ID
        </button>
      </div>
      <div class="col-auto">
        <a th:href="@{/peliculas/buscar}" class="btn btn-primary">
          <i class="bi bi-list-ul"></i> Mostrar Todos
        </a>
      </div>
      <div class="col-auto">
			<a th:href="@{/peliculas}" class="btn btn-secondary">
			<i class="bi bi-arrow-left-circle"></i> Cerrar
			</a>
		</div>
    </form>

    <!-- Alerta de √©xito -->
    <div id="alerta-guardado" class="alert alert-success position-fixed top-0 end-0 m-3 shadow d-none fade show"
         role="alert" style="z-index: 1050; transition: all 0.5s ease-in-out; transform: translateX(100%);">
      <strong>üéâ ¬°√âxito!</strong> Pel√≠cula guardada correctamente.
    </div>

    <!-- Lista de pel√≠culas por g√©nero -->
	<div id="peliculas-genero" class="row row-cols-2 row-cols-md-4 g-3 mb-4" th:if="${catalogoPeliculas != null}">
	  <p th:if="${#lists.isEmpty(catalogoPeliculas)}" class="text-warning">‚ö†Ô∏è No hay pel√≠culas en este g√©nero.</p>
	  <div class="col" th:each="p : ${catalogoPeliculas}">
		<img th:src="@{${p.imagen}}" th:alt="${p.titulo}" class="img-thumb rounded shadow"
		     th:attr="data-id=${p.id}, data-titulo=${p.titulo}, data-descripcion=${p.descripcion}, data-duracion=${p.duracion}, data-categoria=${p.categoriaId}, data-imagen=${p.imagen}"
		     onclick="mostrarFormulario(); seleccionarPeliculaDesdeData(this)">
        <p class="text-center mt-2" th:text="${p.titulo}"></p>
      </div>
    </div>

    <!-- Formulario de Pel√≠cula -->
    <div id="formulario-pelicula" class="card mb-4 shadow d-none">
      <div class="card-body">
		<form th:action="@{${baseUrl + '/peliculas/guardar'}}" th:object="${pelicula}" method="post">
          <input type="hidden" th:field="*{id}" id="id" />
          <input type="hidden" th:field="*{imagen}" id="imagen" />
          <div class="mb-3">
            <label class="form-label">T√≠tulo</label>
            <input type="text" id="titulo" th:field="*{titulo}" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripci√≥n</label>
            <textarea id="descripcion" th:field="*{descripcion}" class="form-control" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Duraci√≥n (minutos)</label>
            <input type="number" id="duracion" th:field="*{duracion}" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">ID de Categor√≠a</label>
            <input type="number" id="categoria_id" th:field="*{categoriaId}" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-primary">Guardar Pel√≠cula üíæ</button>
        </form>
      </div>
    </div>
<!-- Tabla de Pel√≠culas -->
<div class="table-responsive" th:if="${listaPeliculas != null}">
  <table class="table table-bordered table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Imagen</th>
        <th>T√≠tulo</th>
        <th>Descripci√≥n</th>
        <th>Duraci√≥n</th>
        <th>ID Categor√≠a</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="p : ${listaPeliculas}">
        <td th:text="${p.id}">1</td>
        <td>
			<img th:src="${p.imagen}" th:alt="${p.titulo}" class="img-thumb rounded shadow">
        </td>
        <td th:text="${p.titulo}">T√≠tulo</td>
        <td th:text="${p.descripcion}">Descripci√≥n</td>
        <td th:text="${p.duracion}">120</td>
        <td th:text="${p.categoriaId}">2</td>
        <td>
			<a th:href="@{${baseUrl + '/peliculas/editar/' + p.id}}" class="btn btn-warning btn-sm">‚úèÔ∏è Editar</a>
			<a th:href="@{${baseUrl + '/peliculas/eliminar/' + p.id}}" class="btn btn-danger btn-sm">üóëÔ∏è Eliminar</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<footer th:insert="fragments/footer :: pie-pagina" class="footer">
      
</footer>
    
<!-- Scripts -->
<script>
  function seleccionarPeliculaDesdeData(el) {
    document.getElementById('titulo').value = el.dataset.titulo;
    document.getElementById('descripcion').value = el.dataset.descripcion;
    document.getElementById('duracion').value = el.dataset.duracion;
    document.getElementById('categoria_id').value = el.dataset.categoria;
    document.getElementById('imagen').value = el.dataset.imagen;
    if (el.dataset.id) {
      document.getElementById('id').value = el.dataset.id;
    }
  }

  function mostrarFormulario() {
    const form = document.getElementById('formulario-pelicula');
    form.classList.remove('d-none');
  }

  window.addEventListener('DOMContentLoaded', () => {
    const alerta = document.getElementById('alerta-guardado');
    const form = document.getElementById('formulario-pelicula');

    const id = document.getElementById('id').value;
    if (id) {
      // Si hay una pel√≠cula cargada (editar), mostrar el formulario
      form.classList.remove('d-none');
    }

    const params = new URLSearchParams(window.location.search);
    if (params.get('guardado') === 'true') {
      alerta.classList.remove('d-none');
      alerta.style.transform = 'translateX(0%)';
      setTimeout(() => {
        alerta.style.transform = 'translateX(100%)';
        setTimeout(() => {
          alerta.classList.add('d-none');
          document.getElementById('titulo').value = '';
          document.getElementById('descripcion').value = '';
          document.getElementById('duracion').value = '';
          document.getElementById('categoria_id').value = '';
          document.getElementById('imagen').value = '';
          document.getElementById('id').value = '';
          document.getElementById('titulo').focus();
        }, 500);
      }, 3000);
    }
  });

</script>
</body>
</html>